# Actime 已知限制和注意事项

## 平台限制

### Linux平台

#### 1. 仅支持X11环境
**限制**: 当前版本仅支持X11显示服务器，不支持Wayland

**原因**: Wayland的安全模型不允许应用程序监听其他窗口的信息

**影响**: 使用Wayland的用户无法正常使用

**解决方案**:
- 使用XWayland兼容层（部分发行版默认启用）
- 未来版本考虑使用Wayland的Portal API
- 在Wayland环境下显示警告并退出

**相关代码**: `internal/platform/linux_x11.go`

#### 2. 需要DISPLAY环境变量
**限制**: 必须有有效的DISPLAY环境变量

**原因**: X11需要连接到显示服务器

**影响**: 无图形界面的环境（如服务器）无法使用

**解决方案**:
- 启动时检查DISPLAY变量
- 如果不存在，显示错误信息并退出

**相关代码**: `internal/platform/linux_x11.go`

#### 3. 某些桌面环境可能不准确
**限制**: 在某些特殊桌面环境下，窗口检测可能不准确

**原因**: 不同桌面环境的窗口管理行为不同

**影响**: 可能检测不到某些特殊窗口（如全屏游戏）

**解决方案**:
- 针对常见桌面环境测试
- 提供配置选项跳过特定应用

### Windows平台

#### 1. 需要管理员权限（可能）
**限制**: 某些功能可能需要管理员权限

**原因**: 获取其他进程信息可能需要提升权限

**影响**: 在受限环境下可能无法正常工作

**解决方案**:
- 在需要权限时提示用户
- 提供以管理员身份运行的说明

**相关代码**: `internal/platform/windows.go`

#### 2. Windows 7及以上
**限制**: 仅支持Windows 7及更高版本

**原因**: 使用了较新的Win32 API

**影响**: Windows XP及更早版本无法使用

**解决方案**:
- 在安装时检查系统版本
- 不支持的版本显示错误信息

#### 3. UAC可能影响
**限制**: 用户账户控制（UAC）可能影响某些操作

**原因**: 安全机制限制

**影响**: 某些系统调用可能失败

**解决方案**:
- 正确处理权限错误
- 提供清晰的错误提示

## 功能限制

### 1. 不记录输入内容
**限制**: 仅记录是否有输入，不记录具体输入内容

**原因**: 隐私保护，不收集敏感信息

**影响**: 无法进行输入分析

**解决方案**: 不提供此功能（设计决策）

### 2. 5分钟活动窗口
**限制**: 使用5分钟作为活跃判定标准

**原因**: 平衡准确性和性能

**影响**:
- 短时间使用（<5分钟）可能不准确
- 长时间空闲后立即使用可能有延迟

**解决方案**:
- 提供配置选项自定义时间窗口
- 在配置文档中说明

### 3. 检测间隔为1秒
**限制**: 每秒检测一次，不是实时

**原因**: 性能考虑

**影响**:
- 极短时间的窗口切换可能被忽略
- 启动和关闭时间可能有1秒误差

**解决方案**:
- 提供配置选项自定义检测间隔
- 在文档中说明误差范围

### 4. 不支持多用户同时监控
**限制**: 每个用户需要独立运行一个实例

**原因**: 设计为单用户应用

**影响**: 无法监控多个用户的活动

**解决方案**: 不支持此功能（设计决策）

### 5. 不支持远程监控
**限制**: 所有数据仅本地存储

**原因**: 隐私保护，减少安全风险

**影响**: 无法远程查看统计信息

**解决方案**: 不提供此功能（设计决策）

## 性能限制

### 1. 内存占用
**目标**: < 20MB

**影响因素**:
- 数据库大小
- 日志缓冲区
- 系统调用开销

**注意事项**:
- 长时间运行后内存可能增长
- 建议定期重启服务

### 2. CPU占用
**目标**: < 1%（空闲时）

**影响因素**:
- 检测频率
- 数据库写入频率
- 系统调用开销

**注意事项**:
- 大量窗口切换时CPU占用可能增加
- 数据库写入时可能有短暂峰值

### 3. 磁盘IO
**目标**: 最小化

**影响因素**:
- 日志写入频率
- 数据库写入频率

**注意事项**:
- 每分钟写入一次数据库
- 日志文件可能持续增长

## 数据限制

### 1. 数据库大小
**增长速率**: 约每月 < 10MB（正常使用）

**影响因素**:
- 使用频率
- 窗口切换频率
- 保留时间

**注意事项**:
- 长时间使用后数据库可能较大
- 建议定期清理旧数据

### 2. 数据精度
**时间精度**: 秒级

**注意事项**:
- 不是毫秒级精度
- 适合统计用途，不适合精确计时

### 3. 数据一致性
**保证**: 基本一致性（可能丢失最后1分钟数据）

**原因**: 批量写入策略

**注意事项**:
- 异常关闭可能丢失未写入的数据
- 优雅关闭可以避免数据丢失

## 安全限制

### 1. 不加密存储
**限制**: 数据库和日志文件未加密

**原因**: 性能和复杂度考虑

**影响**: 有权限访问文件的用户可以读取数据

**解决方案**:
- 使用文件系统权限保护
- 敏感环境建议加密整个分区

### 2. 不提供访问控制
**限制**: 任何可以访问数据库的用户都可以查看数据

**原因**: 单用户应用设计

**影响**: 多用户系统可能存在隐私问题

**解决方案**:
- 确保数据目录权限正确
- 在多用户环境下谨慎使用

### 3. 不提供审计日志
**限制**: 不记录谁访问了数据

**原因**: 单用户应用设计

**影响**: 无法追踪数据访问

**解决方案**: 不提供此功能（设计决策）

## 已知问题

### 问题1: Wayland不支持
**状态**: 已知限制

**临时方案**: 使用XWayland

**长期方案**: 实现Wayland Portal API支持

### 问题2: 某些全屏应用检测不到
**状态**: 已知问题

**原因**: 特殊窗口属性

**解决方案**: 提供配置选项手动添加

### 问题3: 休眠后可能丢失数据
**状态**: 已知问题

**原因**: 异常关闭

**解决方案**: 实现更频繁的持久化

## 注意事项

### 安装注意事项
1. 确保Go版本 >= 1.21
2. Linux确保X11环境
3. Windows确保有足够权限

### 使用注意事项
1. 首次使用会创建配置文件和数据目录
2. 修改配置后需要重启服务
3. 定期备份数据库文件

### 维护注意事项
1. 定期清理旧数据
2. 监控日志文件大小
3. 定期检查磁盘空间

### 卸载注意事项
1. 停止服务
2. 删除配置文件和数据目录
3. 删除服务配置

## 未来改进

### 短期改进
- [ ] 实现Wayland支持
- [ ] 优化休眠检测
- [ ] 改进错误提示

### 中期改进
- [ ] 添加数据加密选项
- [ ] 实现更细粒度的权限控制
- [ ] 提供更多配置选项

### 长期改进
- [ ] 支持macOS
- [ ] 实现多用户支持
- [ ] 提供Web界面

## 用户反馈

如果您遇到其他限制或问题，请提交Issue。